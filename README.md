# Yaroslam/SSH2
 
## Установка  
для работы библиотеки необходимо: 
1. установленное расширение [SSH2](https://www.php.net/manual/ru/book.ssh2.php)  
1. минимальная версия PHP - 8.1  
1. `composer require yaroslam/ssh2`

## Документация
### Подключение  
Что бы инициализировать подключение к удаленному серверу необходимо создать экземпляр ConnectionInterface и обратиться 
к методу connect, передав в него $connectProperties и $connection, являющийся результатом выполнения функции ssh2_connect() 
модуля SSH2.  

Список экземпляров и формата $connectProperties:
1. UserPasswordConnection ["user" => ' ', 'password' => ' ']

### Сессии
Для создания сессии необходимо создать экземпляр AbstractSession, передав в конструктор экземпляр ConnectionInterface и $connectProperties
формата ['port' => port, 'host' => 'ip',
'properties' => формат $connectProperties для выбранного подтипа ConnectionInterface]  
Типы сессий 
1. Session - не сохраняет контекст выполнения между командами и позволяет использовать только exec() метод
2. ChainSession - сохраняет контекст выполнения между командами и позволяет конструировать сложные сценарии с использованием if, for, switch case конструкций  

ChainSession необходимо инициализировать методом initChain() перед началом использования команд

При использовании любой сессии для получения результата необходимо в конце вызвать метод apply()  
Пример: `$session->exec("ls -la")->apply()`

### Команды
#### Типы команд:
1. Single - одиночная команда, единственные представитель exec()
2. Operator - команды, которые управляют потоком выполнения цепочки команд представители: if(), switch()
3. Block - команды, которые внутри себя хранят другие команды представители: then(), else(), for(), case()
4. None - команды заглушки, представители - все команды с префиксом end
#### Список команд
1. exec($cmd) - выполняет переданную в параметре $cmd команду  
2. if($cmd, $ifStatement) - выполняет переданную в $cmd команду и в дальнейшем проверяет вхождение
$ifStatement в результате выполнения команды, если проверка завершилась успехом, будет выполнена ветка then,
иначе ветка else
3. then() - команда, хранящая в себе список команд, которые должны быть выполнены при успешной проверке условия if команды
4. else() - противоположная по смыслу then команда
5. endIf() - команда, обозначающая окончание команды if()
6. endThen() - команда, обозначающая окончание команды then
7. for($start, $stop, $step) - команда выполняющая все команды внутри своего тела пока внутренний счетчик, стартовое значение которого равно значению $start,
каждый шаг увеличивающийся на значение $step не станет больше или равен значению $stop
8. endFor() - команда, обозначающая окончание команды for()
9. switch($cmd) - команда множественного ветвления, выполняет переданную в $cmd команду, после чего проверяет каждую внутреннюю case() команду 
на вхождение их условий в текст вывода выполненной команды, после чего выполняет первую case() команду с которой было найдено совпадение
10. case($statement) - команда выполняющая все команды внутри себя, если swiесh() команда нашла совпадение с $statement
параметром в тексте вывода своей команды
11. endSwitch() - команда, обозначающая окончание switch() команды
12. endCase() - команда, обозначающая окончание case() команды

#### Пример использования команд
`
$chainSession->initChain()->switch('echo lol')->case('lal')->exec('echo lalka')->endCase()->case('lol')->exec('echo lolka')->endCase()->endSwitch()->for(1; 10; 1)->exec('cd ..')->endFor()->if('ls -la', '.ssh')->then()->exec('cd .ssh')->endThen()->else()->exec('echo dont find')->endElse()->endIf()->apply();
`

### Функции
ChainSession поддерживает создание функций в рамках одного экземпляра. Для этого необходимо вызвать
метод declareFunction($name), где $name - имя функции. Описать используемые в функции команды и завершить функцию
методом endFunction(). Для вызова функции необходимо использовать метод useFunction($name), где $name имя используемой 
функции. Функции можно использовать между вызовами команд.

#### Замечания к командам
Команды if() и case() проверяют вхождение в вывод используя функцию preg_match(), переданное 
условие будет использоваться в качестве регулярного выражения  
Все end команды имеют тип None и не имеют привязки к начинающим командам, проверка 
правильности составления цепочки команд пока что не умеет сопоставлять начало команды с ее концом
и руководствуется правилами зависимостей типов команд друг от друга, это означает
что соблюдение того, какая закрывающая команда используется, остается за пользователем

## Тестирование
Для тестирования используется PHPUnit. В тестах не указаны данные для подключения к серверу, их необходимо указать самостоятельно

# Лицензия
Лицензии нет, используйте как хотите.

